## Coins as Protest Project ##
## Data available upon request after publication. ##

# Necesssary packages.
library(NLP)
library(tm)
library(SnowballC)
library(devtools)
library(tm.plugin.sentiment)
library(rex)
library(stringr)
library(LambertW)

# Loading in corpus.
docs <- file.path("/Users/mat4a/Box Sync/Coins as Protest/Data") 
dir(docs)
corp <- Corpus(DirSource(docs))
summary(corp)
writeLines(as.character(corp[[3]]))

# Polarity and subjectivity scores, emotionality word counts and freqs.
stop <- function(x) removeWords(x, stopwords("english"))
control <- list(removePunctuation, removeNumbers, content_transformer(tolower),
                stop, stripWhitespace, stemDocument)

corp <- tm_map(corp, FUN=tm_reduce, tmFuns=control)
tdm <- TermDocumentMatrix(corp)
freq <- colSums(as.matrix(tdm))
as.matrix(freq)

positive <- inspect(TermDocumentMatrix(corp, list(dictionary=dic_gi$positive)))
negative <- inspect(TermDocumentMatrix(corp, list(dictionary=dic_gi$negative)))
write.csv(positive, file="positive.csv")
write.csv(negative, file="negative.csv")

possum <- colSums(positive, na.rm=F)
negsum <- colSums(negative, na.rm=F)
diff <- possum - negsum
sum <- possum + negsum
result <- diff/sum
result2 <- sum/freq
as.matrix(possum)
result_pos <- possum/freq
result_neg <- negsum/freq
result_diff <- diff/freq
write.csv(result, file="polarity.csv")
write.csv(result2, file="subjectivity.csv")
write.csv(result_pos, file="positivity.csv")
write.csv(result_neg, file="negativity.csv")
write.csv(result_diff, file="difference.csv")
write.csv(possum, file="pos.csv")
write.csv(negsum, file="neg.csv")
write.csv(freq, file="freq.csv")

# Getting t-d matrix with POS tags for coding.
tags <- file.path("/Users/mat4a/Cap/tagged docs")
tags2 <- Corpus(DirSource(tags))
tags2 <- DocumentTermMatrix(tags2)
tags2 <- as.matrix(tags2)
write.csv(tags2, file="tags.csv")
tag3 <- read.csv(file="Person_Tags.csv")
